<html>
  <head>
    <title>
      {gcr}
    </title>
    <link rel="stylesheet" type="text/css" href="/static/css/style.css">
    <script type="text/javascript" src="/static/js/jquery-1.4.2.min.js"></script>
    <script>
      $(document).ready(function() {
        $("button#email-submit").click(function() {
          $("div#email-alert").hide();
          $.post("/add-email/", {"email" : $("input#email-text").val()})
        });
        $("a.add-repo").click(function() {
          var repo = $(this).html();
          $.post("/start-review/", {"repo" : repo});
      // remove this td and add it to under review
        });
      });
    </script>
  </head>
  <body>
    <div id="header">
      <h2>{gcr}</h2>
    </div>
    <div id="reviews-wrapper">
      <% if not @user.email %>
      <div id="email-alert" class="message" style="text-align:center;">Please provide your email address:<input type="text" id="email-text" class="text small"><button class="small" id="email-submit">Submit</button></div>
      <% end %>
    <div id="pendingcount">You have <%= @revs_pending.length %> review<% if @revs_pending.length != 1 %>s<% end %> pending. <% if @revs_pending.length > 0 %>Get cracking!<% else %>Time to relax!<% end %></div>

    <div class="reviews">
    <table class="text">
      <tr>
        <th>
          Repos you own under review
        </th>
      </tr>
      <% if @repos_on.empty? %>
      <tr>
        <td class="last">
          (none)
        </td>
      </tr>
      <% else %>
        <% for repo in @repos_on %>
      <tr>
        <td class="last">
          <%= repo %>
        </td>
      </tr>
      <% end %>
      <% end %>
    </table>
    </div>
    <div class="reviews">
    <table class="text">
      <tr>
        <th>
          Pending reviews <span class="small">&nbsp;&raquo;&nbsp;do these</span>
        </th>
      </tr>
      <% if @revs_pending.empty? %>
      <tr>
        <td class="last">
          (none)
        </td>
      </tr>
      <% else %>
        <% for rev in @revs_pending %>
      <tr>
        <td class="last">
          <%= rev.url %>
        </td>
      </tr>
      <% end %>
      <% end %>
    </table>
    </div>
    <div style="clear:both;"></div>
    <div class="reviews">
    <table class="text">
      <tr>
        <th>
          Repos you own <em>not</em> under review <span class="small">&nbsp&raquo;&nbsp;click one to place it under review</span>
        </th>
      </tr>
      <% if @repos_off.empty? %>
      <tr>
        <td class="last">
          (none)
        </td>
      </tr>
      <% else %>
        <% for repo in @repos_off %>
      <tr>
        <td class="last">
          <a class="add-repo"><%= repo %></a>
        </td>
      </tr>
      <% end %>
      <% end %>
    </table>
    </div>
    <div class="reviews">
    <table class="text">
      <tr>
        <th>
          Recent completed reviews
        </th>
      </tr>
      <% if @revs_completed.empty? %>
      <tr>
        <td class="last">
          (none)
        </td>
      </tr>
      <% else %>
        <% for rev in @revs_completed %>
      <tr>
        <td class="last">
          <% if rev.approved %>
            <span class="completed-positive"><%= rev.url %></span>
          <% else %>
            <span class="completed-negative"><%= rev.url %></span>
          <% end %>
        </td>
      </tr>
      <% end %>
      <% end %>
    </table>
    </div>
    <div style="clear:both;"></div>
    </div>
  </body>
</html>
